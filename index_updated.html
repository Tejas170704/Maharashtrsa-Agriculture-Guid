<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maharashtra Crop & Soil Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" xintegrity="sha512-Fo3rlrZj/k7ujm7e8U+rF2u4A/o6g/qU6y7P1L/y0B7p2r7XzX7I6h9f5/l6F4e8l9E+5f2a1a8t/qO5GzG3A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .container {
            max-width: 900px;
        }
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 400px;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            overflow: hidden;
            background-color: #f8fafc;
        }
        .chat-box {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .chat-message {
            max-width: 80%;
            padding: 0.5rem 1rem;
            border-radius: 1.5rem;
            word-wrap: break-word;
        }
        .user-message {
            background-color: #d1fae5;
            align-self: flex-end;
        }
        .ai-message {
            background-color: #e2e8f0;
            align-self: flex-start;
        }
        .chat-input {
            display: flex;
            padding: 0.75rem;
            border-top: 1px solid #e2e8f0;
            background-color: #ffffff;
        }
        .crop-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .crop-popup-content {
            background-color: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="container mx-auto bg-white rounded-xl shadow-lg p-6 md:p-10">
        <header class="text-center mb-8">
            <h1 id="app-title" class="text-3xl md:text-4xl font-extrabold text-gray-800 leading-tight">
                <i class="fas fa-seedling text-green-500 mr-2"></i>Maharashtra Agriculture Guide
            </h1>
            <p id="app-subtitle" class="mt-2 text-lg text-gray-600">Find the best crops for your soil and weather conditions.</p>
        </header>

        <main class="space-y-8">
            <div class="flex flex-col md:flex-row md:space-x-4 space-y-4 md:space-y-0">
                <div class="relative w-full">
                    <label for="soil-select" id="soil-label" class="block text-gray-700 font-semibold mb-2">Select your Soil Type or Live Location:</label>
                    <div class="relative">
                        <select id="soil-select" class="block appearance-none w-full bg-white border border-gray-300 text-gray-700 py-3 px-4 pr-8 rounded-lg leading-tight focus:outline-none focus:bg-white focus:border-green-500 transition duration-300 ease-in-out">
                            <option value="">-- Select --</option>
                            <option value="LiveLocation">My Live Location</option>
                            <option value="Black">Black Soil</option>
                            <option value="Red">Red Soil</option>
                            <option value="Alluvial">Alluvial Soil</option>
                            <option value="Laterite">Laterite Soil</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                            <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15 8.707l-1.414-1.414L10 10.586 6.707 7.293 5.293 8.707l4 4z"/></svg>
                        </div>
                    </div>
                </div>
                <div class="relative w-full md:w-auto">
                    <label for="lang-select" id="lang-label" class="block text-gray-700 font-semibold mb-2">Select Language:</label>
                    <div class="relative">
                        <select id="lang-select" class="block appearance-none w-full bg-white border border-gray-300 text-gray-700 py-3 px-4 pr-8 rounded-lg leading-tight focus:outline-none focus:bg-white focus:border-green-500 transition duration-300 ease-in-out">
                            <option value="en">English</option>
                            <option value="mr">मराठी</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                            <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15 8.707l-1.414-1.414L10 10.586 6.707 7.293 5.293 8.707l4 4z"/></svg>
                        </div>
                    </div>
                </div>
            </div>

            <div id="loading" class="text-center text-gray-500 hidden">
                <i class="fas fa-spinner fa-spin text-4xl text-green-500"></i>
                <p id="loading-text" class="mt-2 text-md">Fetching live weather data...</p>
            </div>
            
            <div id="results" class="space-y-6">
                <!-- Weather Conditions Section -->
                <div id="weather-conditions" class="bg-blue-50 border-l-4 border-blue-500 text-blue-800 p-4 rounded-lg shadow-sm">
                    <h3 id="weather-heading" class="font-bold text-lg mb-2 flex items-center"><i class="fas fa-cloud-sun text-blue-500 mr-2"></i>Ideal Weather Conditions</h3>
                    <p id="weather-text" class="text-gray-700">Select an option to see details.</p>
                </div>
                
                <!-- Crop Suggestions Section -->
                <div id="crop-suggestions" class="bg-green-50 border-l-4 border-green-500 text-green-800 p-4 rounded-lg shadow-sm">
                    <h3 id="crops-heading" class="font-bold text-lg mb-2 flex items-center"><i class="fas fa-leaf text-green-500 mr-2"></i>Recommended Crops</h3>
                    <div id="crops-list" class="flex flex-wrap gap-4">
                        <p id="default-text" class="text-gray-700">Select a soil type to get crop recommendations.</p>
                    </div>
                </div>

                <!-- Gemini AI Chat Feature -->
                <div id="gemini-chat-container" class="bg-purple-50 border-l-4 border-purple-500 text-purple-800 p-4 rounded-lg shadow-sm hidden">
                    <h3 id="chat-heading" class="font-bold text-lg mb-2 flex items-center"><i class="fas fa-comments text-purple-500 mr-2"></i>AI-Powered Farming Assistant 💬</h3>
                    <div class="chat-container">
                        <div id="chat-box" class="chat-box">
                            <p id="chat-placeholder" class="text-gray-500">Ask me anything about farming in Maharashtra!</p>
                        </div>
                        <div class="chat-input">
                            <textarea id="chat-input" class="flex-grow p-2 border border-gray-300 rounded-lg resize-none" rows="2" placeholder="Your question..."></textarea>
                            <button id="chat-send-btn" class="ml-2 px-4 py-2 bg-purple-600 text-white font-semibold rounded-lg shadow-md hover:bg-purple-700 transition duration-300 ease-in-out">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            
        </main>
    </div>
    
    <!-- Crop Details Popup -->
    <div id="crop-popup" class="crop-popup hidden">
        <div class="crop-popup-content p-8">
            <span id="close-btn" class="close-btn text-gray-500 hover:text-gray-900">&times;</span>
            <div id="popup-content" class="text-center">
                <h2 id="popup-crop-name" class="text-3xl font-bold text-gray-800 mb-4"></h2>
                <div id="popup-image-container" class="my-4">
                    <img id="popup-crop-image" src="" alt="Crop image" class="rounded-lg shadow-md w-full max-h-64 object-cover mb-4">
                </div>
                <p id="popup-description" class="text-gray-700 mb-4 text-left"></p>
                
                <div class="bg-gray-100 p-4 rounded-lg text-left mb-4">
                    <h4 id="popup-growing-method-heading" class="font-bold text-gray-800 mb-2"></h4>
                    <ul id="popup-growing-method" class="list-disc list-inside text-sm text-gray-600 space-y-1"></ul>
                </div>

                <div class="bg-gray-100 p-4 rounded-lg text-left mb-4">
                    <h4 id="popup-harvesting-method-heading" class="font-bold text-gray-800 mb-2"></h4>
                    <ul id="popup-harvesting-method" class="list-disc list-inside text-sm text-gray-600 space-y-1"></ul>
                </div>
                
                <div class="bg-gray-100 p-4 rounded-lg text-left">
                    <h4 id="popup-details-heading" class="font-bold text-gray-800 mb-2"></h4>
                    <ul class="text-sm text-gray-600">
                        <li><i class="fas fa-tint text-blue-400 mr-2"></i><span id="popup-water-needs-label"></span> <span id="popup-water-needs" class="font-medium"></span></li>
                        <li><i class="fas fa-thermometer-half text-red-400 mr-2"></i><span id="popup-ideal-temp-label"></span> <span id="popup-ideal-temp" class="font-medium"></span></li>
                        <li><i class="fas fa-calendar-alt text-yellow-500 mr-2"></i><span id="popup-season-label"></span> <span id="popup-season" class="font-medium"></span></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const soilSelect = document.getElementById('soil-select');
            const langSelect = document.getElementById('lang-select');
            const loadingIndicator = document.getElementById('loading');
            const weatherText = document.getElementById('weather-text');
            const cropsList = document.getElementById('crops-list');
            const defaultText = document.getElementById('default-text');
            const chatContainer = document.getElementById('gemini-chat-container');
            const chatBox = document.getElementById('chat-box');
            const chatInput = document.getElementById('chat-input');
            const chatSendBtn = document.getElementById('chat-send-btn');
            const chatPlaceholder = document.getElementById('chat-placeholder');
            
            const popup = document.getElementById('crop-popup');
            const closeBtn = document.getElementById('close-btn');
            const popupCropName = document.getElementById('popup-crop-name');
            const popupDescription = document.getElementById('popup-description');
            const popupWaterNeeds = document.getElementById('popup-water-needs');
            const popupIdealTemp = document.getElementById('popup-ideal-temp');
            const popupSeason = document.getElementById('popup-season');
            const popupImage = document.getElementById('popup-crop-image');
            const popupGrowingMethod = document.getElementById('popup-growing-method');
            const popupHarvestingMethod = document.getElementById('popup-harvesting-method');
            const popupGrowingMethodHeading = document.getElementById('popup-growing-method-heading');
            const popupHarvestingMethodHeading = document.getElementById('popup-harvesting-method-heading');

            const translations = {
                en: {
                    appTitle: "Maharashtra Agriculture Guide",
                    appSubtitle: "Find the best crops for your soil and weather conditions.",
                    soilLabel: "Select your Soil Type or Live Location:",
                    langLabel: "Select Language:",
                    selectOption: "-- Select --",
                    liveLocation: "My Live Location",
                    blackSoil: "Black Soil",
                    redSoil: "Red Soil",
                    alluvialSoil: "Alluvial Soil",
                    lateriteSoil: "Laterite Soil",
                    loadingText: "Fetching live weather data...",
                    weatherHeading: "Ideal Weather Conditions",
                    cropsHeading: "Recommended Crops",
                    defaultText: "Select a soil type to get crop recommendations.",
                    liveForecast: "Live forecast for",
                    currentTemp: "Current Temp:",
                    forecast: "Forecast:",
                    humidity: "Humidity:",
                    waterNeeds: "Water Needs:",
                    idealTemp: "Ideal Temp:",
                    season: "Season:",
                    soilDescription: "Select an option to see details.",
                    permissionDenied: "Location access denied or not available. Please allow location access to use this feature.",
                    geoUnsupported: "Geolocation is not supported by your browser.",
                    selectSoilForCrops: "Please select a soil type from the list to get crop recommendations for your region.",
                    footer: "© 2023 Maharashtra Agriculture Guide. All rights reserved.",
                    chatHeading: "AI-Powered Farming Assistant 💬",
                    chatPlaceholder: "Ask me anything about farming in Maharashtra!",
                    chatInputPlaceholder: "Your question...",
                    cropDetailsHeading: "Crop Details:",
                    growingMethodHeading: "Growing Method:",
                    harvestingMethodHeading: "Harvesting Method:",
                    crops: {
                        Cotton: { name: "Cotton", image: "https://placehold.co/600x400/22c55e/fff?text=Cotton", water: "Medium", temp: "20-30°C", season: "Kharif", description: "Cotton is a major cash crop, highly suitable for black soil. It requires a long frost-free period and sunny weather, making the Deccan Plateau ideal. Proper soil management and timely irrigation are key for high yields.", growingMethod: ["Sowing: Seeds are sown at the beginning of the monsoon season.", "Irrigation: Requires moderate irrigation, especially during flowering and boll formation.", "Fertilizer: Balanced NPK fertilizers are used to promote healthy growth."], harvestingMethod: ["Picking: Cotton bolls are hand-picked in multiple rounds as they mature and burst open.", "Drying: The harvested cotton is dried in the sun to remove moisture.", "Ginning: The lint (fiber) is separated from the seeds in a ginning process."] },
                        Jowar: { name: "Jowar (Sorghum)", image: "https://placehold.co/600x400/22c55e/fff?text=Jowar+(Sorghum)", water: "Medium", temp: "25-35°C", season: "Kharif/Rabi", description: "Jowar is a staple food grain and a drought-resistant crop. It is grown extensively in the semi-arid regions of Maharashtra, especially on black soil. It requires moderate rainfall and can tolerate high temperatures.", growingMethod: ["Sowing: Sown at the onset of monsoon for Kharif, or in late September for Rabi.", "Irrigation: Requires minimal irrigation as it is a rain-fed crop, but can be irrigated if needed.", "Pest Control: Requires management of pests like shoot flies and stem borers."], harvestingMethod: ["Cutting: The entire plant is cut when the grains are hard and dry.", "Threshing: The grains are separated from the stalks by threshing.", "Storage: The grains are dried well and stored in a cool, dry place."] },
                        Bajra: { name: "Bajra (Millet)", image: "https://placehold.co/600x400/22c55e/fff?text=Bajra+(Millet)", water: "Low", temp: "25-35°C", season: "Kharif", description: "Bajra is a hardy millet crop that thrives in low rainfall and high-temperature conditions. It is a vital crop in drought-prone areas and is grown on black and shallow soils.", growingMethod: ["Sowing: Seeds are sown with the first monsoon rains.", "Weeding: Requires regular weeding to prevent competition for nutrients.", "Pest Control: Less prone to pests but requires occasional monitoring."], harvestingMethod: ["Cutting: The earheads are cut when they are dry and hard.", "Threshing: Grains are threshed to separate them from the earheads.", "Drying: Grains are sun-dried before storage to prevent mold."] },
                        Sugarcane: { name: "Sugarcane", image: "https://placehold.co/600x400/22c55e/fff?text=Sugarcane", water: "High", temp: "20-30°C", season: "Kharif/Year-round", description: "Sugarcane is a water-intensive commercial crop that requires a long growing season. It is a major crop in the fertile black and alluvial soils of Maharashtra, supported by extensive irrigation.", growingMethod: ["Planting: Planted using setts (pieces of sugarcane stalks) in trenches.", "Irrigation: Requires heavy irrigation throughout the growth cycle, often using flood or drip irrigation.", "Fertilizer: Needs high doses of nitrogen, phosphorus, and potash."], harvestingMethod: ["Cutting: The stalks are cut close to the ground, usually by hand.", "Transporting: The cut stalks are bundled and transported to sugar mills.", "Processing: The stalks are crushed to extract juice for sugar production."] },
                        Wheat: { name: "Wheat", image: "https://placehold.co/600x400/22c55e/fff?text=Wheat", water: "Medium", temp: "15-20°C", season: "Rabi", description: "Wheat is a major Rabi crop in Maharashtra. It is grown in the cooler winter months and requires irrigation, especially in black and alluvial soils. The crop is sensitive to high temperatures during its grain-filling stage.", growingMethod: ["Sowing: Sown in October-November after the monsoon season ends.", "Irrigation: Requires timely irrigation, especially at critical growth stages like tillering and flowering.", "Fertilizer: Application of nitrogen and phosphorus is essential."], harvestingMethod: ["Cutting: The crop is harvested when the grains are dry and hard.", "Threshing: Grains are separated from the stalk using a threshing machine.", "Winnowing: The grains are cleaned to remove chaff and other debris before storage."] },
                        Soybean: { name: "Soybean", image: "https://placehold.co/600x400/22c55e/fff?text=Soybean", water: "Medium", temp: "20-25°C", season: "Kharif", description: "Soybean is a significant oilseed and pulse crop. It is a key Kharif crop in Maharashtra, particularly in the Vidarbha region with black soil. It requires moderate rainfall and well-drained soil.", growingMethod: ["Sowing: Sown with the onset of the monsoon.", "Fertilizer: Needs phosphorus and potassium, with nitrogen fixation by nodules.", "Weeding: Timely weeding is crucial to control weeds."], harvestingMethod: ["Cutting: The plants are cut when the leaves turn yellow and fall off.", "Threshing: The pods are threshed to release the beans.", "Drying: The beans are dried and sorted for market or storage."] },
                        Tur: { name: "Tur (Pigeon Pea)", image: "https://placehold.co/600x400/22c55e/fff?text=Tur+(Pigeon+Pea)", water: "Medium", temp: "25-35°C", season: "Kharif", description: "Tur, a pulse crop, is a key source of protein. It is well-suited for black soil and is typically intercropped with other cereals. It is relatively drought-tolerant.", growingMethod: ["Sowing: Sown at the beginning of the monsoon, often as an intercrop.", "Watering: Needs moderate rainfall and can tolerate dry spells.", "Pest Control: Susceptible to pod borers and requires pest management."], harvestingMethod: ["Harvesting: Pods are harvested when they are mature and dry.", "Threshing: The dried pods are threshed to separate the peas.", "Drying: The peas are dried and stored in sealed containers."] },
                        Mung: { name: "Mung (Moong Bean)", image: "https://placehold.co/600x400/22c55e/fff?text=Mung+(Moong+Bean)", water: "Medium", temp: "25-35°C", season: "Kharif", description: "Mung is a short-duration pulse crop that enriches the soil with nitrogen. It is grown in various parts of Maharashtra, performing well in black soil with moderate moisture.", growingMethod: ["Sowing: Sown with the monsoon rains in July.", "Watering: Needs moderate moisture and good drainage.", "Fertilizer: Requires less nitrogen due to its nitrogen-fixing ability."], harvestingMethod: ["Picking: Pods are picked by hand when mature.", "Drying: The pods are dried in the sun.", "Threshing: Grains are separated from the dried pods by threshing."] },
                        Urad: { name: "Urad (Black Gram)", image: "https://placehold.co/600x400/22c55e/fff?text=Urad+(Black+Gram)", water: "Medium", temp: "25-35°C", season: "Kharif", description: "Urad is another important pulse crop known for its soil-enriching properties. It is cultivated during the Kharif season and is a key component of traditional farming systems.", growingMethod: ["Sowing: Sown in June-July with the monsoon.", "Weeding: Requires weeding during the initial growth stages.", "Fertilizer: Responds well to phosphorus fertilizer."], harvestingMethod: ["Cutting: The plants are harvested when the pods are black and dry.", "Threshing: The pods are threshed to get the beans.", "Drying: The beans are sun-dried and stored."] },
                        Gram: { name: "Gram (Chickpea)", image: "https://placehold.co/600x400/22c55e/fff?text=Gram+(Chickpea)", water: "Low", temp: "20-25°C", season: "Rabi", description: "Gram is a Rabi pulse crop grown in cooler months. It is drought-tolerant and thrives in black soil with residual moisture from the monsoon season.", growingMethod: ["Sowing: Sown in October-November in moist soil.", "Irrigation: Generally requires one or two irrigations, but can be grown with residual moisture.", "Pest Control: Susceptible to pod borer and needs timely management."], harvestingMethod: ["Uprooting: The entire plant is uprooted or cut when the leaves turn yellow.", "Threshing: The dried plants are threshed to separate the seeds.", "Cleaning: The seeds are cleaned and graded for sale."] },
                        Maize: { name: "Maize", image: "https://placehold.co/600x400/22c55e/fff?text=Maize", water: "Medium", temp: "21-27°C", season: "Kharif/Rabi", description: "Maize is a versatile cereal and a key livestock feed. It can be grown in both Kharif and Rabi seasons and adapts to a variety of soil types, including black and alluvial.", growingMethod: ["Sowing: Sown at the beginning of the monsoon for Kharif.", "Weeding: Timely weeding and hilling are important.", "Irrigation: Needs regular water supply, especially during flowering and cob formation."], harvestingMethod: ["Harvesting: Cobs are harvested when the kernels are hard.", "Shelling: The kernels are separated from the cobs.", "Drying: Kernels are dried before storage to prevent mold."] },
                        Tobacco: { name: "Tobacco", image: "https://placehold.co/600x400/22c55e/fff?text=Tobacco", water: "Medium", temp: "18-27°C", season: "Kharif/Rabi", description: "Tobacco is a commercial crop that requires careful soil and moisture management. It is grown in specific regions of Maharashtra on fertile soils.", growingMethod: ["Sowing: Seeds are sown in a nursery and seedlings are transplanted.", "Fertilizer: Needs balanced fertilizer application for quality leaves.", "Topping & Desuckering: Removing the top bud and suckers to improve leaf size."], harvestingMethod: ["Priming: Leaves are picked in stages (priming) as they mature from bottom to top.", "Curing: Leaves are cured to develop color, aroma, and flavor.", "Grading: Cured leaves are graded by quality and size."] },
                        Rice: { name: "Rice", image: "https://placehold.co/600x400/22c55e/fff?text=Rice", water: "High", temp: "25-35°C", season: "Kharif/Rabi", description: "Rice is the main staple crop in the Konkan region and eastern Maharashtra. It requires a large amount of water and hot, humid conditions, making alluvial and laterite soils ideal.", growingMethod: ["Sowing: Seeds are sown in a nursery and transplanted to a puddled field.", "Watering: Fields are kept flooded for most of the growing season.", "Fertilizer: Requires high levels of nitrogen."], harvestingMethod: ["Cutting: The crop is cut when the grains are golden yellow and hard.", "Threshing: The grains are separated from the panicles by threshing.", "Milling: The paddy is milled to remove the husk and bran."] },
                        Groundnut: { name: "Groundnut", image: "https://placehold.co/600x400/22c55e/fff?text=Groundnut", water: "Low", temp: "25-30°C", season: "Kharif", description: "Groundnut is an important oilseed crop that prefers well-drained, red and black soils. It is a Kharif crop that requires warm temperatures and can tolerate low moisture.", growingMethod: ["Sowing: Sown with the onset of the monsoon.", "Weeding: Regular weeding is crucial, especially in the initial stages.", "Pest Control: Susceptible to various pests, requiring timely management."], harvestingMethod: ["Digging: The pods are dug out when the leaves turn yellow.", "Drying: The pods are dried in the sun.", "Shelling: The peanuts are separated from the shells, either by hand or machine."] },
                        Pulses: { name: "Pulses", image: "https://placehold.co/600x400/22c55e/fff?text=Pulses", water: "Medium", temp: "15-30°C", season: "Kharif/Rabi", description: "Pulses are a diverse group of crops that are vital for food security and soil health. They are grown in various soils and seasons, enriching the soil with nitrogen.", growingMethod: ["Sowing: Sown at the beginning of the respective season.", "Irrigation: Require less water than cereals, often rain-fed.", "Fertilizer: Require minimal nitrogen fertilizer due to nitrogen fixation."], harvestingMethod: ["Cutting: Plants are harvested when the pods are mature and dry.", "Threshing: Pods are threshed to get the beans/peas.", "Drying: The harvested pulses are dried and sorted for storage."] },
                        Turmeric: { name: "Turmeric", image: "https://placehold.co/600x400/22c55e/fff?text=Turmeric", water: "Medium", temp: "20-30°C", season: "Kharif", description: "Turmeric is a commercial spice crop. It requires a warm and humid climate and well-drained red or alluvial soil. It is a high-value crop.", growingMethod: ["Planting: Planted using rhizomes (mother rhizomes and fingers).", "Irrigation: Requires irrigation at regular intervals, especially during dry spells.", "Fertilizer: Responds well to organic manures and balanced fertilizers."], harvestingMethod: ["Uprooting: The rhizomes are uprooted when the leaves turn yellow.", "Curing: The rhizomes are boiled, dried, and polished.", "Processing: The dried rhizomes are ground into powder for sale."] },
                        Onions: { name: "Onions", image: "https://placehold.co/600x400/22c55e/fff?text=Onions", water: "Medium", temp: "13-25°C", season: "Rabi", description: "Onions are a major vegetable crop, with Maharashtra being a leading producer. They are grown primarily in the Rabi season on fertile alluvial and red soils, requiring moderate temperatures.", growingMethod: ["Sowing: Seeds are sown in a nursery and transplanted as seedlings.", "Irrigation: Requires regular watering, especially during bulb formation.", "Fertilizer: Needs nitrogen, phosphorus, and potassium for good bulb growth."], harvestingMethod: ["Toppling: The tops of the plants are bent down to force maturity.", "Uprooting: Bulbs are uprooted when the leaves begin to dry.", "Curing: The bulbs are cured in a well-ventilated space to develop a strong outer skin."] },
                        ExoticVegetables: { name: "Exotic Vegetables", image: "https://placehold.co/600x400/22c55e/fff?text=Exotic+Vegetables", water: "Medium", temp: "15-25°C", season: "Year-round", description: "Exotic vegetables like broccoli, lettuce, and bell peppers are increasingly grown in Maharashtra with modern farming techniques for higher returns. They require controlled irrigation and specific temperature ranges.", growingMethod: ["Sowing: Seeds are sown in a nursery and transplanted.", "Cultivation: Often grown in polyhouses or shade nets for controlled environment.", "Irrigation: Drip irrigation is used to provide consistent moisture."], harvestingMethod: ["Picking: Vegetables are harvested when they reach the right size and maturity.", "Grading: They are sorted by size and quality for the market.", "Packaging: Packed carefully to prevent damage during transport."] },
                        Grapes: { name: "Grapes", image: "https://placehold.co/600x400/22c55e/fff?text=Grapes", water: "Medium", temp: "15-30°C", season: "Rabi", description: "Maharashtra is known for its premium grapes, especially in the Nashik region. They thrive in well-drained alluvial soil and cool winter temperatures.", growingMethod: ["Planting: Planted as rooted cuttings in well-prepared soil.", "Pruning: Vines are pruned annually to manage growth and fruit quality.", "Irrigation: Drip irrigation is commonly used to ensure precise water delivery."], harvestingMethod: ["Cutting: Bunches are cut from the vine when they reach the desired sweetness.", "Sorting: Bunches are sorted and graded by size and quality.", "Packaging: Packed in punnets for local sale or export."] },
                        Bananas: { name: "Bananas", image: "https://placehold.co/600x400/22c55e/fff?text=Bananas", water: "High", temp: "20-30°C", season: "Year-round", description: "Bananas are a tropical fruit requiring a hot, humid climate and fertile soil. They are grown year-round with high water needs in regions with alluvial soil.", growingMethod: ["Planting: Planted using suckers (shoots) from the parent plant.", "Watering: Requires a high and consistent water supply.", "Fertilizer: Needs balanced fertilization to support rapid growth."], harvestingMethod: ["Cutting: The bunch is cut from the tree when the fruits are mature.", "Ripening: The bunches are ripened in a controlled environment.", "Sorting: Bananas are sorted and packaged for transport."] },
                        Oranges: { name: "Oranges", image: "https://placehold.co/600x400/22c55e/fff?text=Oranges", water: "Medium", temp: "20-35°C", season: "Year-round", description: "Oranges are a popular citrus fruit. They are grown in regions with hot summers and cool winters, thriving in alluvial and black soils.", growingMethod: ["Planting: Planted as saplings in well-drained soil.", "Pruning: Trees are pruned to maintain shape and encourage new growth.", "Irrigation: Requires regular watering, especially during fruit development."], harvestingMethod: ["Picking: Fruits are hand-picked when they are fully ripe.", "Grading: Fruits are sorted by size and quality.", "Packaging: Packed in crates for local and distant markets."] },
                        Cashew: { name: "Cashew", image: "https://placehold.co/600x400/22c55e/fff?text=Cashew", water: "Low", temp: "20-35°C", season: "Summer", description: "Cashew is a plantation crop in the Konkan region. It is highly drought-resistant and thrives in the laterite soil of coastal Maharashtra.", growingMethod: ["Planting: Planted from seeds or grafts.", "Watering: Requires minimal water and is often rain-fed.", "Weeding: Requires regular weeding to reduce competition."], harvestingMethod: ["Gathering: The ripe cashews (nut and apple) are gathered from the ground.", "Drying: The nuts are sun-dried.", "Processing: The nuts are roasted and shelled to get the edible kernel."] },
                        Mango: { name: "Mango", image: "https://placehold.co/600x400/22c55e/fff?text=Mango", water: "Medium", temp: "24-27°C", season: "Summer", description: "Mangoes, especially the famous Alphonso variety, are a major fruit crop in the Konkan. They grow best in well-drained laterite soil with a distinct dry season.", growingMethod: ["Planting: Planted using grafts from a known variety.", "Irrigation: Requires irrigation in the initial years, but mature trees are rain-fed.", "Fertilizer: Needs balanced fertilizer to support flowering and fruiting."], harvestingMethod: ["Picking: Mangoes are hand-picked when they are mature but still green.", "Ripening: Fruits are ripened in a controlled environment.", "Sorting: Graded by size and quality before packaging."] },
                        Coconut: { name: "Coconut", image: "https://placehold.co/600x400/22c55e/fff?text=Coconut", water: "High", temp: "20-30°C", season: "Year-round", description: "Coconut palms are a vital crop in the coastal Konkan belt. They require high rainfall, warm temperatures, and laterite soil.", growingMethod: ["Planting: Planted as seedlings in pits.", "Irrigation: Requires consistent watering, especially in dry periods.", "Fertilizer: Needs regular application of fertilizers and manures."], harvestingMethod: ["Plucking: Mature coconuts are plucked from the trees.", "Husking: The outer husk is removed.", "Drying: The kernel is dried to produce copra or sold fresh."] },
                        Ragi: { name: "Ragi", image: "https://placehold.co/600x400/22c55e/fff?text=Ragi", water: "Low", temp: "25-35°C", season: "Kharif", description: "Ragi is a highly nutritious millet that is drought-resistant. It grows well in laterite soils with low water needs, making it a reliable crop for challenging conditions.", growingMethod: ["Sowing: Sown directly or by transplanting seedlings.", "Weeding: Requires weeding during the initial growth phase.", "Fertilizer: Responds well to organic manures."], harvestingMethod: ["Cutting: The earheads are cut when they are mature and dry.", "Threshing: Grains are threshed to separate them.", "Cleaning: The grains are cleaned and stored in a dry place."] },
                        Vegetables: { name: "Vegetables", image: "https://placehold.co/600x400/22c55e/fff?text=Vegetables", water: "Medium", temp: "15-25°C", season: "Year-round", description: "Maharashtra produces a wide range of vegetables, including tomatoes, brinjals, and leafy greens. They are grown across various soil types, with fertile alluvial and red soils being particularly productive.", growingMethod: ["Sowing: Seeds are sown in a nursery and transplanted.", "Irrigation: Needs regular watering, often through drip or furrow irrigation.", "Fertilizer: Requires balanced nutrients to support continuous fruiting."], harvestingMethod: ["Picking: Vegetables are harvested by hand as they mature.", "Sorting: They are sorted by size and quality.", "Packaging: Packed into baskets or crates for transport."] }
                    },
                    seasons: {
                        Kharif: "Kharif", Rabi: "Rabi", YearRound: "Year-round", Summer: "Summer"
                    },
                    waterNeeds: {
                        High: "High", Medium: "Medium", Low: "Low"
                    },
                    weatherData: {
                        Nagpur: { temp: "28°C", forecast: "Partly Cloudy", humidity: "70%" },
                        Ratnagiri: { temp: "25°C", forecast: "Heavy Rainfall", humidity: "90%" },
                        Nashik: { temp: "22°C", forecast: "Mild and Humid", humidity: "75%" },
                        Kolhapur: { temp: "26°C", forecast: "Scattered Showers", humidity: "85%" }
                    }
                },
                mr: {
                    appTitle: "महाराष्ट्र कृषी मार्गदर्शक",
                    appSubtitle: "आपल्या माती आणि हवामानानुसार योग्य पिकांची माहिती मिळवा.",
                    soilLabel: "तुमची माती किंवा थेट स्थान निवडा:",
                    langLabel: "भाषा निवडा:",
                    selectOption: "-- निवडा --",
                    liveLocation: "माझे थेट स्थान",
                    blackSoil: "काळी माती",
                    redSoil: "लाल माती",
                    alluvialSoil: "गाळाची माती",
                    lateriteSoil: "जांभा माती",
                    loadingText: "थेट हवामान डेटा मिळवत आहे...",
                    weatherHeading: "आदर्श हवामानाची स्थिती",
                    cropsHeading: "शिफारस केलेली पिके",
                    defaultText: "पिकांच्या शिफारशींसाठी मातीचा प्रकार निवडा.",
                    liveForecast: "साठी थेट हवामान अंदाज",
                    currentTemp: "सध्याचे तापमान:",
                    forecast: "अंदाज:",
                    humidity: "आर्द्रता:",
                    waterNeeds: "पाण्याची गरज:",
                    idealTemp: "आदर्श तापमान:",
                    season: "हंगाम:",
                    soilDescription: "माहिती पाहण्यासाठी एक पर्याय निवडा.",
                    permissionDenied: "स्थान वापरण्याची परवानगी नाकारली किंवा उपलब्ध नाही. कृपया या सुविधेचा वापर करण्यासाठी परवानगी द्या.",
                    geoUnsupported: "तुमच्या ब्राउझरमध्ये थेट स्थान समर्थित नाही.",
                    selectSoilForCrops: "तुमच्या प्रदेशासाठी पिकांच्या शिफारशी मिळवण्यासाठी मातीचा प्रकार निवडा.",
                    footer: "© २०२३ महाराष्ट्र कृषी मार्गदर्शक. सर्व हक्क राखीव.",
                    chatHeading: "एआय-चालित शेती सहायक 💬",
                    chatPlaceholder: "महाराष्ट्रातील शेतीबद्दल काहीही विचारा!",
                    chatInputPlaceholder: "तुमचा प्रश्न...",
                    cropDetailsHeading: "पिकांची माहिती:",
                    growingMethodHeading: "लागवडीची पद्धत:",
                    harvestingMethodHeading: "काढणीची पद्धत:",
                    crops: {
                        Cotton: { name: "कापूस", image: "https://placehold.co/600x400/22c55e/fff?text=Cotton", water: "मध्यम", temp: "20-30°C", season: "खरीप", description: "कापूस हे एक प्रमुख नगदी पीक आहे, जे काळ्या मातीसाठी अत्यंत योग्य आहे. त्याला जास्त काळ थंडी-मुक्त आणि सूर्यप्रकाशाची आवश्यकता असते, ज्यामुळे दख्खनचा पठार त्याच्यासाठी आदर्श ठरतो. उच्च उत्पादनासाठी योग्य माती व्यवस्थापन आणि वेळेवर सिंचन महत्त्वाचे आहे.", growingMethod: ["पेरणी: पावसाळ्याच्या सुरुवातीला बियाणे पेरले जातात.", "सिंचन: फुलोरा आणि बोंड तयार होण्याच्या वेळी मध्यम सिंचन आवश्यक असते.", "खत: चांगल्या वाढीसाठी संतुलित NPK खतांचा वापर केला जातो."], harvestingMethod: ["वेचणी: कापसाचे बोंड परिपक्व झाल्यावर आणि फुटल्यावर अनेक टप्प्यांत हाताने वेचले जातात.", "वाळवणे: वेचलेला कापूस वाळवण्यासाठी उन्हात ठेवला जातो.", "जिनिंग: जिनिंग प्रक्रियेत सरकीपासून कापूस वेगळा केला जातो."] },
                        Jowar: { name: "ज्वारी", image: "https://placehold.co/600x400/22c55e/fff?text=Jowar", water: "मध्यम", temp: "25-35°C", season: "खरीप/रबी", description: "ज्वारी हे एक महत्त्वाचे अन्नधान्य आणि दुष्काळ-प्रतिरोधक पीक आहे. हे महाराष्ट्राच्या अर्ध-शुष्क प्रदेशांमध्ये, विशेषतः काळ्या मातीवर मोठ्या प्रमाणात घेतले जाते. त्याला मध्यम पाऊस लागतो आणि उच्च तापमान सहन करण्याची क्षमता असते.", growingMethod: ["पेरणी: खरीपासाठी पावसाळ्याच्या सुरुवातीला किंवा रबीसाठी सप्टेंबरच्या शेवटी पेरणी केली जाते.", "सिंचन: हे पावसावर आधारित पीक असल्यामुळे कमी सिंचन लागते, पण गरज असल्यास सिंचन करता येते.", "कीटक नियंत्रण: खोडमाशीसारख्या कीटकांचे व्यवस्थापन आवश्यक आहे."], harvestingMethod: ["कापणी: दाणे कडक आणि कोरडे झाल्यावर संपूर्ण पीक कापले जाते.", "मळणी: मळणी यंत्राच्या मदतीने कडब्यापासून दाणे वेगळे केले जातात.", "साठवणूक: दाणे चांगले वाळवून थंड आणि कोरड्या ठिकाणी साठवले जातात."] },
                        Bajra: { name: "बाजरी", image: "https://placehold.co/600x400/22c55e/fff?text=Bajra", water: "कमी", temp: "25-35°C", season: "खरीप", description: "बाजरी हे एक टणक बाजरीचे पीक आहे, जे कमी पाऊस आणि उच्च तापमानात चांगले वाढते. दुष्काळग्रस्त भागांमध्ये हे एक महत्त्वाचे पीक आहे आणि ते काळ्या आणि उथळ मातीवर घेतले जाते.", growingMethod: ["पेरणी: पावसाच्या पहिल्या सरी झाल्यावर बियाणे पेरले जातात.", "निंदणी: तणांच्या स्पर्धेतून वाचवण्यासाठी नियमित निंदणी आवश्यक आहे.", "कीटक नियंत्रण: यावर कमी कीड पडते, पण निरीक्षण आवश्यक आहे."], harvestingMethod: ["कापणी: कणसे कोरडी आणि कडक झाल्यावर कापली जातात.", "मळणी: दाणे कणसापासून मळणी करून वेगळे केले जातात.", "वाळवणे: साठवण्यापूर्वी दाणे उन्हात चांगले वाळवले जातात."] },
                        Sugarcane: { name: "ऊस", image: "https://placehold.co/600x400/22c55e/fff?text=Sugarcane", water: "जास्त", temp: "20-30°C", season: "खरीप/वर्षभर", description: "ऊस हे जास्त पाणी लागणारे व्यावसायिक पीक आहे, ज्याला वाढण्यासाठी जास्त वेळ लागतो. महाराष्ट्रातील सुपीक काळ्या आणि गाळाच्या मातीत हे एक प्रमुख पीक आहे, ज्याला मोठ्या प्रमाणावर सिंचनाची मदत केली जाते.", growingMethod: ["लागवड: उसाचे तुकडे (सेट्स) वापरून लागवड केली जाते.", "सिंचन: संपूर्ण वाढीच्या काळात भरपूर पाणी लागते, सामान्यतः ठिबक किंवा पूर सिंचन वापरले जाते.", "खत: नायट्रोजन, फॉस्फरस आणि पोटॅश मोठ्या प्रमाणात आवश्यक असते."], harvestingMethod: ["कापणी: ऊस जमिनीच्या जवळून कापला जातो, सहसा हाताने.", "वाहतूक: कापलेले ऊस साखर कारखान्यात पाठवले जातात.", "प्रक्रिया: रसापासून साखर बनवण्यासाठी उसाची मळणी केली जाते."] },
                        Wheat: { name: "गहू", image: "https://placehold.co/600x400/22c55e/fff?text=Wheat", water: "मध्यम", temp: "15-20°C", season: "रबी", description: "गहू हे महाराष्ट्रातील एक प्रमुख रबी पीक आहे. हे थंड हिवाळ्यात घेतले जाते आणि त्याला सिंचनाची आवश्यकता असते, विशेषतः काळ्या आणि गाळाच्या मातीत. दाणे भरण्याच्या टप्प्यात हे पीक उच्च तापमानाला संवेदनशील असते.", growingMethod: ["पेरणी: पावसाळ्यानंतर ऑक्टोबर-नोव्हेंबरमध्ये पेरणी केली जाते.", "सिंचन: गव्हाला वेळेवर सिंचन आवश्यक आहे, विशेषतः वाढीच्या महत्त्वाच्या टप्प्यांवर.", "खत: नायट्रोजन आणि फॉस्फरसचा वापर महत्त्वाचा आहे."], harvestingMethod: ["कापणी: दाणे कोरडे आणि कडक झाल्यावर पीक कापले जाते.", "मळणी: मळणी यंत्राच्या मदतीने दाणे वेगळे केले जातात.", "उफणणी: साठवण्यापूर्वी दाणे साफ केले जातात."] },
                        Soybean: { name: "सोयाबीन", image: "https://placehold.co/600x400/22c55e/fff?text=Soybean", water: "मध्यम", temp: "20-25°C", season: "खरीप", description: "सोयाबीन हे एक महत्त्वाचे तेलबिया आणि डाळीचे पीक आहे. हे महाराष्ट्रातील विदर्भ प्रदेशातील काळ्या मातीमध्ये एक प्रमुख खरीप पीक आहे. त्याला मध्यम पाऊस आणि योग्य निचऱ्याची माती आवश्यक आहे.", growingMethod: ["पेरणी: पावसाळ्याच्या सुरुवातीला पेरणी केली जाते.", "खत: नायट्रोजन स्थिरीकरणामुळे त्याला फॉस्फरस आणि पोटॅशची जास्त गरज असते.", "निंदणी: तण काढण्यासाठी वेळेवर निंदणी करणे महत्त्वाचे आहे."], harvestingMethod: ["कापणी: पाने पिवळी पडून गळून गेल्यावर झाडे कापली जातात.", "मळणी: शेंगांमधून दाणे काढण्यासाठी मळणी केली जाते.", "वाळवणे: दाणे वाळवून साठवले जातात."] },
                        Tur: { name: "तूर", image: "https://placehold.co/600x400/22c55e/fff?text=Tur", water: "मध्यम", temp: "25-35°C", season: "खरीप", description: "तूर, हे एक डाळीचे पीक आहे, जे प्रथिनांचा महत्त्वाचा स्रोत आहे. हे काळ्या मातीसाठी योग्य आहे आणि सामान्यतः इतर धान्यांसोबत आंतरपीक म्हणून घेतले जाते. हे तुलनेने दुष्काळ-प्रतिरोधक आहे.", growingMethod: ["पेरणी: पावसाळ्याच्या सुरुवातीला पेरणी केली जाते, अनेकदा आंतरपीक म्हणून.", "सिंचन: मध्यम पाऊस आवश्यक आहे आणि कमी पावसाला सहन करू शकते.", "कीटक नियंत्रण: शेंगा पोखरणारे कीटक यावर हल्ला करतात, त्यामुळे व्यवस्थापन आवश्यक आहे."], harvestingMethod: ["कापणी: शेंगा परिपक्व आणि कोरड्या झाल्यावर काढल्या जातात.", "मळणी: वाळलेल्या शेंगांची मळणी करून दाणे वेगळे केले जातात.", "वाळवणे: दाणे चांगले वाळवून साठवले जातात."] },
                        Mung: { name: "मूग", image: "https://placehold.co/600x400/22c55e/fff?text=Mung", water: "मध्यम", temp: "25-35°C", season: "खरीप", description: "मूग हे कमी कालावधीचे डाळीचे पीक आहे, जे नायट्रोजनने माती समृद्ध करते. हे महाराष्ट्रातील विविध भागांमध्ये घेतले जाते आणि मध्यम ओलावा असलेल्या काळ्या मातीत चांगले वाढते.", growingMethod: ["पेरणी: जुलैमध्ये पावसाच्या सुरुवातीला पेरणी केली जाते.", "पाणी: मध्यम ओलावा आणि चांगला निचरा आवश्यक आहे.", "खत: नायट्रोजन स्थिरीकरणामुळे त्याला कमी नायट्रोजन खत लागते."], harvestingMethod: ["वेचणी: शेंगा परिपक्व झाल्यावर हाताने वेचल्या जातात.", "वाळवणे: शेंगा उन्हात वाळवल्या जातात.", "मळणी: वाळलेल्या शेंगांची मळणी करून दाणे वेगळे केले जातात."] },
                        Urad: { name: "उडीद", image: "https://placehold.co/600x400/22c55e/fff?text=Urad", water: "मध्यम", temp: "25-35°C", season: "खरीप", description: "उडीद हे नायट्रोजनने माती समृद्ध करणारे आणखी एक महत्त्वाचे डाळीचे पीक आहे. हे खरीप हंगामात घेतले जाते आणि पारंपारिक शेती पद्धतींचा एक महत्त्वाचा भाग आहे.", growingMethod: ["पेरणी: जून-जुलैमध्ये पावसासोबत पेरणी केली जाते.", "निंदणी: वाढीच्या सुरुवातीच्या टप्प्यात निंदणी आवश्यक आहे.", "खत: फॉस्फरस खताला चांगला प्रतिसाद देतो."], harvestingMethod: ["कापणी: शेंगा काळ्या आणि कोरड्या झाल्यावर झाडे कापली जातात.", "मळणी: शेंगांची मळणी करून दाणे काढले जातात.", "वाळवणे: दाणे उन्हात वाळवून साठवले जातात."] },
                        Gram: { name: "हरभरा", image: "https://placehold.co/600x400/22c55e/fff?text=Gram", water: "कमी", temp: "20-25°C", season: "रबी", description: "हरभरा हे रबी डाळीचे पीक थंड महिन्यांत घेतले जाते. हे दुष्काळ-प्रतिरोधक आहे आणि मान्सूननंतरच्या ओलाव्याने युक्त काळ्या मातीत चांगले वाढते.", growingMethod: ["पेरणी: ऑक्टोबर-नोव्हेंबरमध्ये ओलसर मातीत पेरणी केली जाते.", "सिंचन: सामान्यतः एक किंवा दोन सिंचन पुरेसे असते, पण पावसावरही घेतले जाऊ शकते.", "कीटक नियंत्रण: घाटे अळीचा प्रादुर्भाव होतो, त्यामुळे वेळेवर व्यवस्थापन आवश्यक आहे."], harvestingMethod: ["उपटणे: पाने पिवळी झाल्यावर संपूर्ण झाड उपटले जाते किंवा कापले जाते.", "मळणी: वाळलेल्या झाडांची मळणी करून दाणे वेगळे केले जातात.", "स्वच्छ करणे: दाणे विक्रीसाठी किंवा साठवणीसाठी साफ केले जातात."] },
                        Maize: { name: "मका", image: "https://placehold.co/600x400/22c55e/fff?text=Maize", water: "मध्यम", temp: "21-27°C", season: "खरीप/रबी", description: "मका हे एक बहुउपयोगी धान्य आणि जनावरांसाठी महत्त्वाचे खाद्य आहे. ते खरीप आणि रबी दोन्ही हंगामात घेतले जाऊ शकते आणि काळ्या व गाळाच्या मातीसह विविध प्रकारच्या मातीमध्ये वाढते.", growingMethod: ["पेरणी: खरीपासाठी पावसाळ्याच्या सुरुवातीला पेरणी केली जाते.", "निंदणी: वेळेवर निंदणी आणि माती भरणे महत्त्वाचे आहे.", "सिंचन: फुलोरा आणि दाणे भरण्याच्या वेळी नियमित पाणी पुरवठा आवश्यक आहे."], harvestingMethod: ["कापणी: दाणे कडक झाल्यावर कणसे काढली जातात.", "सोलीस: कणसापासून दाणे वेगळे केले जातात.", "वाळवणे: साठवण्यापूर्वी दाणे वाळवले जातात."] },
                        Tobacco: { name: "तंबाखू", image: "https://placehold.co/600x400/22c55e/fff?text=Tobacco", water: "मध्यम", temp: "18-27°C", season: "खरीप/रबी", description: "तंबाखू हे एक व्यावसायिक पीक आहे ज्याला योग्य माती आणि ओलावा व्यवस्थापनाची आवश्यकता असते. हे महाराष्ट्राच्या विशिष्ट प्रदेशांमध्ये सुपीक मातीवर घेतले जाते.", growingMethod: ["लागवड: बियाणे रोपवाटिकेत पेरून रोपे लावली जातात.", "खत: चांगल्या प्रतीच्या पानांसाठी संतुलित खत आवश्यक आहे.", "शेंडा खुडणी: पानांचा आकार सुधारण्यासाठी शेंडे आणि बगलफुटी काढली जाते."], harvestingMethod: ["वेचणी: पाने परिपक्व झाल्यावर खालून वरच्या बाजूला टप्प्याटप्प्याने वेचली जातात.", "सुके करणे: पाने सुकवून रंग आणि सुगंध विकसित केला जातो.", "प्रतवारी: सुकलेली पाने गुणवत्ता आणि आकारानुसार वेगळी केली जातात."] },
                        Rice: { name: "भात", image: "https://placehold.co/600x400/22c55e/fff?text=Rice", water: "जास्त", temp: "25-35°C", season: "खरीप/रबी", description: "भात हे कोकण प्रदेश आणि पूर्व महाराष्ट्रातील मुख्य पीक आहे. त्याला जास्त पाणी आणि उष्ण, दमट हवामानाची आवश्यकता असते, ज्यामुळे गाळाची आणि जांभा माती त्याच्यासाठी आदर्श ठरते.", growingMethod: ["पेरणी: बियाणे रोपवाटिकेत पेरून रोपे चिखलाच्या शेतात लावली जातात.", "पाणी: वाढीच्या काळात शेतात पाणी साठवून ठेवले जाते.", "खत: जास्त प्रमाणात नायट्रोजनची आवश्यकता असते."], harvestingMethod: ["कापणी: दाणे पिवळे आणि कडक झाल्यावर पीक कापले जाते.", "मळणी: दाणे लोंब्यांपासून वेगळे केले जातात.", "पोलीस: भाताला पॉलिश करून कोंडा आणि भुसा काढला जातो."] },
                        Groundnut: { name: "भुईमूग", image: "https://placehold.co/600x400/22c55e/fff?text=Groundnut", water: "कमी", temp: "25-30°C", season: "खरीप", description: "भुईमूग हे एक महत्त्वाचे तेलबिया पीक आहे, जे चांगल्या निचऱ्याच्या लाल आणि काळ्या मातीत चांगले वाढते. हे खरीप पीक आहे ज्याला उबदार तापमानाची आवश्यकता असते आणि कमी ओलावा सहन करू शकते.", growingMethod: ["पेरणी: पावसाळ्याच्या सुरुवातीला पेरणी केली जाते.", "निंदणी: सुरुवातीच्या काळात नियमित निंदणी आवश्यक आहे.", "कीटक नियंत्रण: विविध कीटकांचा प्रादुर्भाव होतो, त्यामुळे वेळेवर व्यवस्थापन आवश्यक आहे."], harvestingMethod: ["उपटणे: पाने पिवळी झाल्यावर शेंगा उपटल्या जातात.", "वाळवणे: शेंगा उन्हात वाळवल्या जातात.", "सोलीस: शेंगांमधून दाणे हाताने किंवा यंत्राने वेगळे केले जातात."] },
                        Pulses: { name: "डाळी", image: "https://placehold.co/600x400/22c55e/fff?text=Pulses", water: "मध्यम", temp: "15-30°C", season: "खरीप/रबी", description: "डाळी हे विविध पिकांचा समूह आहे जे अन्नसुरक्षा आणि मातीच्या आरोग्यासाठी महत्त्वाचे आहेत. ते विविध माती आणि हंगामांमध्ये घेतले जातात आणि मातीला नायट्रोजनने समृद्ध करतात.", growingMethod: ["पेरणी: संबंधित हंगामाच्या सुरुवातीला पेरणी केली जाते.", "सिंचन: धान्यांपेक्षा कमी पाणी लागते, अनेकदा पावसावर अवलंबून असते.", "खत: नायट्रोजन स्थिरीकरणामुळे कमी नायट्रोजन खत लागते."], harvestingMethod: ["कापणी: शेंगा परिपक्व आणि कोरड्या झाल्यावर झाडे कापली जातात.", "मळणी: शेंगांची मळणी करून दाणे काढले जातात.", "वाळवणे: काढणी केलेली डाळी वाळवून साठवली जाते."] },
                        Turmeric: { name: "हळद", image: "https://placehold.co/600x400/22c55e/fff?text=Turmeric", water: "मध्यम", temp: "20-30°C", season: "खरीप", description: "हळद हे एक व्यावसायिक मसाला पीक आहे. त्याला उष्ण आणि दमट हवामान आणि चांगल्या निचऱ्याची लाल किंवा गाळाची माती आवश्यक आहे. हे एक उच्च-मूल्याचे पीक आहे.", growingMethod: ["लागवड: हळकुंडे (गाठी) वापरून लागवड केली जाते.", "सिंचन: कोरड्या हंगामात नियमित सिंचन आवश्यक आहे.", "खत: सेंद्रिय खते आणि संतुलित खतांना चांगला प्रतिसाद देतो."], harvestingMethod: ["उपटणे: पाने पिवळी झाल्यावर हळकुंडे उपटली जातात.", "प्रक्रिया: हळकुंडे उकळून, वाळवून आणि पॉलिश केली जातात.", "मळणी: वाळलेली हळकुंडे दळून पावडर बनवली जाते."] },
                        Onions: { name: "कांदे", image: "https://placehold.co/600x400/22c55e/fff?text=Onions", water: "मध्यम", temp: "13-25°C", season: "रबी", description: "कांदे हे एक प्रमुख भाजीपाला पीक आहे, ज्यात महाराष्ट्राचा एक अग्रगण्य उत्पादक म्हणून समावेश आहे. ते प्रामुख्याने रबी हंगामात सुपीक गाळाच्या आणि लाल मातीत घेतले जातात, ज्यांना मध्यम तापमानाची आवश्यकता असते.", growingMethod: ["पेरणी: बियाणे रोपवाटिकेत पेरून रोपे लावली जातात.", "सिंचन: कांद्यांना नियमित पाणी आवश्यक आहे, विशेषतः कंद तयार होताना.", "खत: चांगल्या कंदाच्या वाढीसाठी नायट्रोजन, फॉस्फरस आणि पोटॅशियम आवश्यक आहे."], harvestingMethod: ["कापणी: पाने सुकायला लागल्यावर कांदे उपटले जातात.", "वाळवणे: कंद चांगल्या प्रकारे हवेशीर ठिकाणी वाळवले जातात.", "प्रतवारी: कांद्याची गुणवत्ता आणि आकारानुसार प्रतवारी केली जाते."] },
                        ExoticVegetables: { name: "विदेशी भाज्या", image: "https://placehold.co/600x400/22c55e/fff?text=Exotic+Vegetables", water: "मध्यम", temp: "15-25°C", season: "वर्षभर", description: "ब्रोकोली, लेट्युस आणि बेल पेपर्स सारख्या विदेशी भाज्या महाराष्ट्रात जास्त नफ्यासाठी आधुनिक शेती तंत्रज्ञानाने वाढवल्या जात आहेत. त्यांना नियंत्रित सिंचन आणि विशिष्ट तापमानाची आवश्यकता असते.", growingMethod: ["पेरणी: बियाणे रोपवाटिकेत पेरून रोपे लावली जातात.", "लागवड: पॉलीहाऊस किंवा शेडनेटमध्ये नियंत्रित वातावरणात घेतली जातात.", "सिंचन: ठिबक सिंचनाने नियमित पाणी पुरवठा केला जातो."], harvestingMethod: ["वेचणी: भाज्या योग्य आकार आणि परिपक्वता आल्यावर वेचल्या जातात.", "प्रतवारी: आकार आणि गुणवत्तानुसार प्रतवारी केली जाते.", "पॅकेजिंग: वाहतुकीदरम्यान नुकसान टाळण्यासाठी पॅक केले जाते."] },
                        Grapes: { name: "द्राक्षे", image: "https://placehold.co/600x400/22c55e/fff?text=Grapes", water: "मध्यम", temp: "15-30°C", season: "रबी", description: "नाशिक प्रदेशातील उत्कृष्ट द्राक्षांसाठी महाराष्ट्र ओळखला जातो. ते चांगल्या निचऱ्याच्या गाळाच्या मातीत आणि थंड हिवाळ्याच्या तापमानात चांगले वाढतात.", growingMethod: ["लागवड: कलमांद्वारे लागवड केली जाते.", "छाटणी: द्राक्षांची गुणवत्ता आणि वाढ व्यवस्थापित करण्यासाठी वार्षिक छाटणी केली जाते.", "सिंचन: ठिबक सिंचन सामान्यतः वापरले जाते."], harvestingMethod: ["तोडणी: द्राक्षांचे घोस योग्य गोडवा आल्यावर तोडले जातात.", "प्रतवारी: घोस आकार आणि गुणवत्तानुसार वेगळे केले जातात.", "पॅकेजिंग: स्थानिक विक्री आणि निर्यातीसाठी पॅक केले जातात."] },
                        Bananas: { name: "केळी", image: "https://placehold.co/600x400/22c55e/fff?text=Bananas", water: "जास्त", temp: "20-30°C", season: "वर्षभर", description: "केळी हे एक उष्णकटिबंधीय फळ आहे, ज्याला उष्ण, दमट हवामान आणि सुपीक मातीची आवश्यकता असते. ते जास्त पाणी लागणाऱ्या गाळाच्या मातीच्या प्रदेशात वर्षभर घेतले जातात.", growingMethod: ["लागवड: मातृवृक्षापासून फुटलेले केळफूल वापरून लागवड केली जाते.", "पाणी: नियमित आणि भरपूर पाणी पुरवठा आवश्यक आहे.", "खत: चांगल्या वाढीसाठी संतुलित खत आवश्यक आहे."], harvestingMethod: ["कापणी: फळे परिपक्व झाल्यावर घोस झाडापासून कापला जातो.", "पिकवणे: घोस नियंत्रित वातावरणात पिकवले जातात.", "प्रतवारी: केळी प्रतवारी करून पॅक केली जातात."] },
                        Oranges: { name: "संत्रे", image: "https://placehold.co/600x400/22c55e/fff?text=Oranges", water: "मध्यम", temp: "20-35°C", season: "वर्षभर", description: "संत्रे हे एक लोकप्रिय लिंबूवर्गीय फळ आहे. ते उष्ण उन्हाळा आणि थंड हिवाळा असलेल्या प्रदेशात घेतले जातात, ज्यामुळे ते गाळाच्या आणि काळ्या मातीत चांगले वाढतात.", growingMethod: ["लागवड: रोपांद्वारे लागवड केली जाते.", "छाटणी: झाडांना योग्य आकार देण्यासाठी छाटणी केली जाते.", "सिंचन: फळांच्या वाढीसाठी नियमित पाणी आवश्यक आहे."], harvestingMethod: ["तोडणी: फळे पूर्ण पिकल्यावर हाताने तोडली जातात.", "प्रतवारी: फळांची प्रतवारी केली जाते.", "पॅकेजिंग: स्थानिक आणि दूरच्या बाजारपेठांसाठी क्रेटमध्ये पॅक केली जातात."] },
                        Cashew: { name: "काजू", image: "https://placehold.co/600x400/22c55e/fff?text=Cashew", water: "कमी", temp: "20-35°C", season: "उन्हाळा", description: "काजू हे कोकण प्रदेशातील एक लागवडीचे पीक आहे. ते दुष्काळ-प्रतिरोधक आहे आणि महाराष्ट्राच्या किनारपट्टीवरील जांभा मातीत चांगले वाढते.", growingMethod: ["लागवड: बियाणे किंवा कलमांद्वारे लागवड केली जाते.", "पाणी: कमीत कमी पाणी लागते, अनेकदा पावसावर अवलंबून असते.", "निंदणी: तण काढणे आवश्यक आहे."], harvestingMethod: ["गोळा करणे: पिकलेले काजू (शेंगा) जमिनीवरून गोळा केले जातात.", "वाळवणे: शेंगा उन्हात वाळवल्या जातात.", "प्रक्रिया: शेंगा भाजून आणि फोडून दाणे काढले जातात."] },
                        Mango: { name: "आंबा", image: "https://placehold.co/600x400/22c55e/fff?text=Mango", water: "मध्यम", temp: "24-27°C", season: "उन्हाळा", description: "आंबे, विशेषतः प्रसिद्ध हापूस जातीचे, कोकणातील एक प्रमुख फळपीक आहे. ते चांगल्या निचऱ्याच्या जांभा मातीत आणि स्पष्ट कोरड्या हंगामात उत्तम वाढतात.", growingMethod: ["लागवड: चांगल्या जातीच्या कलमांद्वारे लागवड केली जाते.", "सिंचन: सुरुवातीच्या वर्षात सिंचन आवश्यक असते, पण मोठी झाडे पावसावर अवलंबून असतात.", "खत: फुलोरा आणि फळांच्या वाढीसाठी संतुलित खत आवश्यक आहे."], harvestingMethod: ["तोडणी: आंबे पिकण्यापूर्वी, हिरवे असताना हाताने तोडले जातात.", "पिकवणे: आंबे नियंत्रित वातावरणात पिकवले जातात.", "प्रतवारी: पॅक करण्यापूर्वी आकार आणि गुणवत्तानुसार प्रतवारी केली जाते."] },
                        Coconut: { name: "नारळ", image: "https://placehold.co/600x400/22c55e/fff?text=Coconut", water: "जास्त", temp: "20-30°C", season: "वर्षभर", description: "नारळाचे झाड हे कोकण किनारपट्टीवरील एक महत्त्वाचे पीक आहे. त्याला जास्त पाऊस, उष्ण तापमान आणि जांभा मातीची आवश्यकता असते.", growingMethod: ["लागवड: रोपांद्वारे खड्ड्यात लागवड केली जाते.", "सिंचन: कोरड्या हंगामात नियमित पाणी आवश्यक आहे.", "खत: नियमित खत आणि सेंद्रिय खतांचा वापर आवश्यक आहे."], harvestingMethod: ["तोडणी: नारळ पिकल्यावर तोडले जातात.", "साल काढणे: बाहेरील साल काढली जाते.", "वाळवणे: आतील गर वाळवून खोबरे बनवले जाते किंवा ताजे विकले जाते."] },
                        Ragi: { name: "नाचणी", image: "https://placehold.co/600x400/22c55e/fff?text=Ragi", water: "कमी", temp: "25-35°C", season: "खरीप", description: "नाचणी हे एक अत्यंत पौष्टिक बाजरीचे पीक आहे, जे दुष्काळ-प्रतिरोधक आहे. ते कमी पाणी लागणाऱ्या जांभा मातीत चांगले वाढते, ज्यामुळे ते आव्हानात्मक परिस्थितीत एक विश्वसनीय पीक ठरते.", growingMethod: ["पेरणी: थेट पेरणी केली जाते किंवा रोपे लावली जातात.", "निंदणी: वाढीच्या सुरुवातीच्या टप्प्यात निंदणी आवश्यक आहे.", "खत: सेंद्रिय खतांना चांगला प्रतिसाद देतो."], harvestingMethod: ["कापणी: कणसे परिपक्व आणि कोरडी झाल्यावर कापली जातात.", "मळणी: कणसांमधून दाणे वेगळे केले जातात.", "स्वच्छ करणे: दाणे साफ करून कोरड्या ठिकाणी साठवले जातात."] },
                        Vegetables: { name: "भाज्या", image: "https://placehold.co/600x400/22c55e/fff?text=Vegetables", water: "मध्यम", temp: "15-25°C", season: "वर्षभर", description: "महाराष्ट्रामध्ये टोमॅटो, वांगी आणि पालेभाज्यांसह अनेक प्रकारच्या भाज्यांचे उत्पादन होते. त्या विविध प्रकारच्या मातीत घेतल्या जातात, ज्यात सुपीक गाळाची आणि लाल माती विशेषतः उत्पादनक्षम आहे.", growingMethod: ["पेरणी: बियाणे रोपवाटिकेत पेरून रोपे लावली जातात.", "सिंचन: ठिबक किंवा पाट सिंचनाने नियमित पाणी आवश्यक आहे.", "खत: सतत फळे लागण्यासाठी संतुलित खत आवश्यक आहे."], harvestingMethod: ["वेचणी: भाज्या परिपक्व झाल्यावर हाताने वेचल्या जातात.", "प्रतवारी: आकार आणि गुणवत्तानुसार प्रतवारी केली जाते.", "पॅकेजिंग: वाहतुकीसाठी क्रेटमध्ये पॅक केले जातात."] }
                    },
                    seasons: {
                        Kharif: "खरीप", Rabi: "रबी", YearRound: "वर्षभर", Summer: "उन्हाळा"
                    },
                    waterNeeds: {
                        High: "जास्त", Medium: "मध्यम", Low: "कमी"
                    },
                    weatherData: {
                        Nagpur: { temp: "28°C", forecast: "ढगाळ", humidity: "70%" },
                        Ratnagiri: { temp: "25°C", forecast: "मुसळधार पाऊस", humidity: "90%" },
                        Nashik: { temp: "22°C", forecast: "सौम्य आणि दमट", humidity: "75%" },
                        Kolhapur: { temp: "26°C", forecast: "विखुरलेला पाऊस", humidity: "85%" }
                    }
                }
            };
            
            const agriData = {
                "Black": {
                    city: "Nagpur",
                    crops: [
                        { name: "Cotton", water: "Medium", temp: "20-30°C", season: "Kharif" },
                        { name: "Jowar", water: "Medium", temp: "25-35°C", season: "Kharif/Rabi" },
                        { name: "Bajra", water: "Low", temp: "25-35°C", season: "Kharif" },
                        { name: "Sugarcane", water: "High", temp: "20-30°C", season: "Kharif/Year-round" },
                        { name: "Wheat", water: "Medium", temp: "15-20°C", season: "Rabi" },
                        { name: "Soybean", water: "Medium", temp: "20-25°C", season: "Kharif" },
                        { name: "Tur", water: "Medium", temp: "25-35°C", season: "Kharif" },
                        { name: "Mung", water: "Medium", temp: "25-35°C", season: "Kharif" },
                        { name: "Urad", water: "Medium", temp: "25-35°C", season: "Kharif" },
                        { name: "Gram", water: "Low", temp: "20-25°C", season: "Rabi" },
                        { name: "Maize", water: "Medium", temp: "21-27°C", season: "Kharif/Rabi" },
                        { name: "Tobacco", water: "Medium", temp: "18-27°C", season: "Kharif/Rabi" },
                    ]
                },
                "Red": {
                    city: "Ratnagiri",
                    crops: [
                        { name: "Rice", water: "High", temp: "25-35°C", season: "Kharif/Rabi" },
                        { name: "Groundnut", water: "Low", temp: "25-30°C", season: "Kharif" },
                        { name: "Pulses", water: "Medium", temp: "15-30°C", season: "Kharif/Rabi" },
                        { name: "Turmeric", water: "Medium", temp: "20-30°C", season: "Kharif" },
                        { name: "Onions", water: "Medium", temp: "13-25°C", season: "Rabi" },
                        { name: "ExoticVegetables", water: "Medium", temp: "15-25°C", season: "Year-round" }
                    ]
                },
                "Alluvial": {
                    city: "Nashik",
                    crops: [
                        { name: "Rice", water: "High", temp: "25-35°C", season: "Kharif/Rabi" },
                        { name: "Wheat", water: "Medium", temp: "15-20°C", season: "Rabi" },
                        { name: "Sugarcane", water: "High", temp: "20-30°C", season: "Kharif/Year-round" },
                        { name: "Pulses", water: "Medium", temp: "15-30°C", season: "Kharif/Rabi" },
                        { name: "Grapes", water: "Medium", temp: "15-30°C", season: "Rabi" },
                        { name: "Onions", water: "Medium", temp: "13-25°C", season: "Rabi" },
                        { name: "Bananas", water: "High", temp: "20-30°C", season: "Year-round" },
                        { name: "Oranges", water: "Medium", temp: "20-35°C", season: "Year-round" },
                        { name: "Maize", water: "Medium", temp: "21-27°C", season: "Kharif/Rabi" },
                    ]
                },
                "Laterite": {
                    city: "Kolhapur",
                    crops: [
                        { name: "Cashew", water: "Low", temp: "20-35°C", season: "Summer" },
                        { name: "Mango", water: "Medium", temp: "24-27°C", season: "Summer" },
                        { name: "Coconut", water: "High", temp: "20-30°C", season: "Year-round" },
                        { name: "Rice", water: "High", temp: "25-35°C", season: "Kharif/Rabi" },
                        { name: "Ragi", water: "Low", temp: "25-35°C", season: "Kharif" }
                    ]
                }
            };
            
            let currentLang = 'en';
            let chatHistory = [];

            const updateUI = () => {
                const lang = translations[currentLang];
                document.getElementById('app-title').innerHTML = `<i class="fas fa-seedling text-green-500 mr-2"></i>${lang.appTitle}`;
                document.getElementById('app-subtitle').textContent = lang.appSubtitle;
                document.getElementById('soil-label').textContent = lang.soilLabel;
                document.getElementById('lang-label').textContent = lang.langLabel;
                document.getElementById('loading-text').textContent = lang.loadingText;
                document.getElementById('weather-heading').innerHTML = `<i class="fas fa-cloud-sun text-blue-500 mr-2"></i>${lang.weatherHeading}`;
                document.getElementById('crops-heading').innerHTML = `<i class="fas fa-leaf text-green-500 mr-2"></i>${lang.cropsHeading}`;
                document.getElementById('footer-text').textContent = lang.footer;
                document.getElementById('chat-heading').innerHTML = `<i class="fas fa-comments text-purple-500 mr-2"></i>${lang.chatHeading}`;
                chatInput.placeholder = lang.chatInputPlaceholder;
                chatPlaceholder.textContent = lang.chatPlaceholder;
                
                // Update select options
                const soilOptions = {
                    "LiveLocation": lang.liveLocation,
                    "Black": lang.blackSoil,
                    "Red": lang.redSoil,
                    "Alluvial": lang.alluvialSoil,
                    "Laterite": lang.lateriteSoil
                };
                document.querySelectorAll('#soil-select option').forEach(option => {
                    if (option.value === "") {
                        option.textContent = lang.selectOption;
                    } else {
                        option.textContent = soilOptions[option.value] || option.value;
                    }
                });

                // Update crop popup text
                document.getElementById('popup-details-heading').textContent = lang.cropDetailsHeading;
                document.getElementById('popup-water-needs-label').textContent = `${lang.waterNeeds}:`;
                document.getElementById('popup-ideal-temp-label').textContent = `${lang.idealTemp}:`;
                document.getElementById('popup-season-label').textContent = `${lang.season}:`;
                popupGrowingMethodHeading.textContent = lang.growingMethodHeading;
                popupHarvestingMethodHeading.textContent = lang.harvestingMethodHeading;
                
                // Trigger change event to re-render data
                const selectedValue = soilSelect.value;
                if (selectedValue) {
                    soilSelect.dispatchEvent(new Event('change'));
                } else {
                    weatherText.textContent = lang.soilDescription;
                    defaultText.textContent = lang.defaultText;
                    chatContainer.classList.add('hidden');
                }
            };
            
            langSelect.addEventListener('change', (event) => {
                currentLang = event.target.value;
                updateUI();
            });

            const getLiveWeatherForCity = async (city) => {
                await new Promise(resolve => setTimeout(resolve, 1000)); 
                const mockWeather = translations[currentLang].weatherData[city] || { temp: "N/A", forecast: "Unknown", humidity: "N/A" };
                return mockWeather;
            };

            const getLiveWeatherForLocation = async (lat, lon) => {
                await new Promise(resolve => setTimeout(resolve, 1000)); 
                
                let cityName = translations[currentLang].liveLocation;
                let stateName = '';
                
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`);
                    const data = await response.json();
                    
                    if (data && data.address) {
                        cityName = data.address.city || data.address.town || data.address.village || data.address.hamlet || 'Unknown City';
                        stateName = data.address.state || '';
                    }
                } catch (error) {
                    console.error("Error fetching city name:", error);
                }

                return {
                    temp: "27°C",
                    forecast: currentLang === 'mr' ? 'उन्हाळी वातावरण, हलक्या सरींची शक्यता' : "Sunny with a chance of showers",
                    humidity: "65%",
                    location: `${cityName}${stateName ? ', ' + stateName : ''}`
                };
            };
            
            const appendMessage = (role, text) => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `chat-message ${role}-message`;
                messageDiv.textContent = text;
                chatBox.appendChild(messageDiv);
                chatBox.scrollTop = chatBox.scrollHeight;
            };

            const handleChat = async () => {
                const userMessage = chatInput.value.trim();
                if (!userMessage) return;

                chatInput.value = '';
                chatPlaceholder.classList.add('hidden');
                
                // Add user message to chat history and UI
                chatHistory.push({ role: 'user', parts: [{ text: userMessage }] });
                appendMessage('user', userMessage);

                // Show AI loading message
                const aiLoadingMessage = document.createElement('div');
                aiLoadingMessage.className = 'chat-message ai-message';
                aiLoadingMessage.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                chatBox.appendChild(aiLoadingMessage);
                chatBox.scrollTop = chatBox.scrollHeight;

                const systemPrompt = "You are a helpful and knowledgeable agricultural expert from Maharashtra. Provide concise and accurate answers to the user's questions. Do not use an emoji at the end.";
                
                const payload = {
                    contents: chatHistory,
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                    model: "gemini-2.5-flash-preview-05-20"
                };

                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                let response;
                let retries = 0;
                const maxRetries = 3;
                while (retries < maxRetries) {
                    try {
                        response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        if (response.status !== 429) {
                            break; 
                        }
                        retries++;
                        await new Promise(res => setTimeout(res, Math.pow(2, retries) * 1000));
                    } catch (error) {
                        console.error('Fetch error:', error);
                        break;
                    }
                }

                chatBox.removeChild(aiLoadingMessage);

                const result = await response.json();
                const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text || translations[currentLang].chatPlaceholder;

                // Add AI response to chat history and UI
                chatHistory.push({ role: 'model', parts: [{ text: generatedText }] });
                appendMessage('ai', generatedText);
            };

            const showCropDetails = async (cropName) => {
                const lang = translations[currentLang];
                const cropData = Object.values(agriData).flatMap(soil => soil.crops).find(crop => crop.name === cropName);
                if (!cropData) return;
                
                const translatedCropData = lang.crops[cropName];

                popupCropName.textContent = translatedCropData.name;
                popupDescription.textContent = translatedCropData.description;
                popupWaterNeeds.textContent = translatedCropData.water;
                popupIdealTemp.textContent = translatedCropData.temp;
                popupSeason.textContent = translatedCropData.season;
                
                popupImage.src = translatedCropData.image;

                popupGrowingMethod.innerHTML = '';
                translatedCropData.growingMethod.forEach(step => {
                    const li = document.createElement('li');
                    li.textContent = step;
                    popupGrowingMethod.appendChild(li);
                });
                
                popupHarvestingMethod.innerHTML = '';
                translatedCropData.harvestingMethod.forEach(step => {
                    const li = document.createElement('li');
                    li.textContent = step;
                    popupHarvestingMethod.appendChild(li);
                });
                
                popup.classList.remove('hidden');
            };
            
            closeBtn.addEventListener('click', () => {
                popup.classList.add('hidden');
            });

            soilSelect.addEventListener('change', async (event) => {
                const selectedValue = event.target.value;
                const lang = translations[currentLang];
                cropsList.innerHTML = '';
                defaultText.classList.add('hidden');
                loadingIndicator.classList.remove('hidden');

                if (selectedValue === "LiveLocation") {
                    chatContainer.classList.add('hidden');
                    if ("geolocation" in navigator) {
                        navigator.geolocation.getCurrentPosition(async (position) => {
                            const lat = position.coords.latitude;
                            const lon = position.coords.longitude;
                            
                            const liveWeather = await getLiveWeatherForLocation(lat, lon);
                            loadingIndicator.classList.add('hidden');

                            weatherText.innerHTML = `
                                <i class="fas fa-map-marker-alt text-blue-500 mr-2"></i>${lang.liveForecast} **${liveWeather.location}**:
                                <br>
                                - <i class="fas fa-thermometer-half text-red-400 mr-2"></i>${lang.currentTemp} <span class="font-medium">${liveWeather.temp}</span>
                                <br>
                                - <i class="fas fa-cloud-sun text-blue-500 mr-2"></i>${lang.forecast} <span class="font-medium">${liveWeather.forecast}</span>
                                <br>
                                - <i class="fas fa-water text-cyan-500 mr-2"></i>${lang.humidity} <span class="font-medium">${liveWeather.humidity}</span>
                            `;
                            cropsList.innerHTML = `
                                <p class="text-gray-700">${lang.selectSoilForCrops}</p>
                            `;
                            chatHistory = [];
                        }, (error) => {
                            loadingIndicator.classList.add('hidden');
                            weatherText.innerHTML = `<i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>${lang.permissionDenied}`;
                            cropsList.innerHTML = `<p class="text-gray-700">${lang.defaultText}</p>`;
                            chatHistory = [];
                        });
                    } else {
                        loadingIndicator.classList.add('hidden');
                        weatherText.innerHTML = `<i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>${lang.geoUnsupported}`;
                    }
                } else if (selectedValue in agriData) {
                    const data = agriData[selectedValue];
                    const liveWeather = await getLiveWeatherForCity(data.city);
                    loadingIndicator.classList.add('hidden');
                    chatContainer.classList.remove('hidden');
                    chatHistory = [];
                    chatPlaceholder.classList.remove('hidden');
                    chatBox.innerHTML = `<p id="chat-placeholder" class="text-gray-500">${lang.chatPlaceholder}</p>`;
                    
                    weatherText.innerHTML = `
                        <i class="fas fa-map-marker-alt text-blue-500 mr-2"></i>${lang.liveForecast} **${data.city}**:
                        <br>
                        - <i class="fas fa-thermometer-half text-red-400 mr-2"></i>${lang.currentTemp} <span class="font-medium">${liveWeather.temp}</span>
                        <br>
                        - <i class="fas fa-cloud-sun text-blue-500 mr-2"></i>${lang.forecast} <span class="font-medium">${liveWeather.forecast}</span>
                        <br>
                        - <i class="fas fa-water text-cyan-500 mr-2"></i>${lang.humidity} <span class="font-medium">${liveWeather.humidity}</span>
                    `;

                    data.crops.forEach(crop => {
                        const cropCard = document.createElement('button');
                        cropCard.className = "bg-white p-4 rounded-lg shadow-md flex-1 min-w-48 transition-transform transform hover:scale-105 duration-300 ease-in-out border border-green-200 text-left cursor-pointer";
                        cropCard.onclick = () => showCropDetails(crop.name);
                        
                        const translatedCropName = lang.crops[crop.name].name || crop.name;
                        const translatedWaterNeeds = lang.waterNeeds[crop.water] || crop.water;
                        const translatedSeason = lang.seasons[crop.season] || crop.season;
                        
                        cropCard.innerHTML = `
                            <h4 class="text-md font-semibold text-gray-900">${translatedCropName}</h4>
                            <ul class="text-sm text-gray-600 mt-2">
                                <li><i class="fas fa-tint text-blue-400 mr-2"></i>${lang.waterNeeds} <span class="font-medium">${translatedWaterNeeds}</span></li>
                                <li><i class="fas fa-thermometer-half text-red-400 mr-2"></i>${lang.idealTemp} <span class="font-medium">${crop.temp}</span></li>
                                <li><i class="fas fa-calendar-alt text-yellow-500 mr-2"></i>${lang.season} <span class="font-medium">${translatedSeason}</span></li>
                            </ul>
                        `;
                        cropsList.appendChild(cropCard);
                    });
                } else {
                    loadingIndicator.classList.add('hidden');
                    weatherText.textContent = lang.soilDescription;
                    defaultText.classList.remove('hidden');
                    chatContainer.classList.add('hidden');
                }
            });
            
            chatSendBtn.addEventListener('click', handleChat);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleChat();
                }
            });
            
            updateUI();
        });
    </script>
</body>
</html>
